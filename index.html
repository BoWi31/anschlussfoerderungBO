<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Anschlussförderung BO - Dashboard</title>
  <style>
    body{font-family:Arial,sans-serif;text-align:center;margin:0;padding:20px;transition:background-color .5s ease-in-out;background:linear-gradient(180deg,#4CAF50,#388E3C);color:#fff}
    h1{font-size:24px;font-weight:bold;text-transform:uppercase;margin-bottom:10px}
    #clock{font-size:24px;font-weight:bold;background:rgba(255,255,255,.2);padding:10px;border-radius:8px;display:inline-block;margin-bottom:15px;box-shadow:0 4px 8px rgba(0,0,0,.2)}
    .box{background:rgba(255,255,255,.15);padding:15px;margin:10px auto;border-radius:12px;box-shadow:0 6px 12px rgba(0,0,0,.3);max-width:90%;text-align:center;backdrop-filter:blur(8px);transition:transform .3s}
    .box:hover{transform:scale(1.02)}
    .hidden{display:none}
    .left-align{text-align:left;padding-left:15px;font-size:16px}
    .countdown{font-size:20px;font-weight:bold;margin-top:10px}
    @media (max-width:600px){h1{font-size:20px}#clock{font-size:20px;padding:8px}.box{padding:12px}.left-align{font-size:14px;padding-left:10px}.countdown{font-size:18px}}
    #toggleBtn,#toggleBtnBack{margin:6px 0 14px 0;padding:10px 14px;border:none;border-radius:10px;font-size:15px;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.25);background:rgba(255,255,255,.2);color:#fff;transition:transform .15s ease,background .3s ease}
    #toggleBtn:hover,#toggleBtnBack:hover{transform:translateY(-1px);background:rgba(255,255,255,.3)}
    #toggleBtn:active,#toggleBtnBack:active{transform:translateY(0)}
    .subtle{opacity:.9}
  </style>
</head>
<body id="pageBody">
  <div id="statusView">
    <div class="box">
      <h1 id="mainTitle">Anschlussförderung BO ✅</h1>
      <p id="dayDisplay"></p>
    </div>

    <button id="toggleBtn" aria-pressed="false" aria-controls="overviewView">SuS & Gruppen (Termine)</button>

    <div id="clock">--:--:--</div>

    <div class="box hidden" id="groupInfoBox">
      <h3 id="groupTitle"></h3>
      <p id="teacherLine" class="subtle"></p>
      <div id="groupInfo"></div>
      <p class="countdown hidden" id="countdown"></p>
    </div>
  </div>

  <div id="overviewView" class="hidden" aria-live="polite">
    <div class="box">
      <h2>Übersicht – Gruppen, SuS & Termine</h2>
      <div id="overviewContent"></div>
    </div>
    <button id="toggleBtnBack" aria-pressed="true" aria-controls="statusView">Zurück zum Status</button>
  </div>

  <audio id="alertSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>

  <script>
    // Gruppen (BO)
    const schedule = [
      {
        group: "1",
        times: [
          { day: 2, start: "09:50", end: "11:20" }, // Di 3./4
          { day: 3, start: "09:50", end: "11:20" }, // Mi 3./4
          { day: 3, start: "11:40", end: "13:10" }, // Mi 5./6
          { day: 4, start: "11:40", end: "13:10" }, // Do 5./6
          { day: 5, start: "08:00", end: "09:30" }, // Fr 1./2
          { day: 5, start: "11:40", end: "13:10" }  // Fr 5./6
        ],
        students: [
          "Mohammed A. (8.1)", "Evelina (8.1)", "Mohammed H. (8.1)", "Veysel (8.1)",
          "Amar (8.2)", "Blind (8.2)", "Beyar (8.2)", "Ili (8.2)", "Altin (8.1)"
        ]
      },
      {
        group: "2",
        times: [
          { day: 1, start: "09:50", end: "11:20" }, // Mo 3./4
          { day: 2, start: "08:00", end: "09:30" }, // Di 1./2
          { day: 5, start: "09:50", end: "11:20" }  // Fr 3./4
        ],
        students: [
          "Bahar (8a)", "Violetta (8a)", "Justina (8a)", "Stasia (8a)",
          "Arzoo (8.1)", "Emma (8.1)", "Zelal (8.2)", "Ilyas (8.2)"
        ]
      }
    ];

    // Lehrkräfte (sichtbar im Status); Mathe-ASF erfasst, aber ausgeblendet
    const teacherAssignments = [
      { teacher: "Kue", slots: [
        { day: 2, start: "08:00", end: "09:30" }, // Di 1./2 (Gr.2)
        { day: 2, start: "09:50", end: "11:20" }, // Di 3./4 (Gr.1)
        { day: 5, start: "09:50", end: "11:20" }  // Fr 3./4 (Gr.2)
      ]},
      { teacher: "Lun", slots: [
        { day: 3, start: "09:50", end: "11:20" }  // Mi 3./4 (Gr.1)
      ]},
      { teacher: "Bas", slots: [
        { day: 3, start: "11:40", end: "13:10" }, // Mi 5./6 (Gr.1)
        { day: 4, start: "11:40", end: "13:10" }, // Do 5./6 (Gr.1)
        { day: 5, start: "11:40", end: "13:10" }  // Fr 5./6 (Gr.1)
      ]},
      { teacher: "Har", slots: [
        { day: 5, start: "08:00", end: "09:30" }  // Fr 1./2 (Gr.1)
      ]},
      // Erfasst, aber nicht angezeigt:
      { teacher: "Mathe (Beu)", slots: [
        { day: 4, start: "09:50", end: "11:20" }  // Do 3./4
      ]}
    ];

    const dayNames=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];
    const pad2=n=>n.toString().padStart(2,"0");
    const normTime=t=>{const [h,m]=t.split(":").map(Number);return `${pad2(h)}:${pad2(m)}`};
    const slotKey=(d,s,e)=>`${d}|${normTime(s)}|${normTime(e)}`;

    // Slot -> sichtbare Lehrkraft (Mathe-ASF NICHT mappen)
    const slotTeacherMap=new Map();
    schedule.forEach(g=>g.times.forEach(t=>{
      const k=slotKey(t.day,t.start,t.end);
      teacherAssignments.forEach(a=>a.slots.forEach(s=>{
        if(slotKey(s.day,s.start,s.end)===k && !a.teacher.includes("Mathe")) slotTeacherMap.set(k,a.teacher);
      }));
    }));

    let lastFiveMinuteAlertKey=null, isOverview=false;

    function updateClock(){ document.getElementById("clock").innerText=new Date().toLocaleTimeString("de-DE"); }

    function updateDisplay(){
      if(isOverview) return;
      const now=new Date(); const today=now.getDay();
      document.getElementById("dayDisplay").innerText=`${dayNames[today]}, ${now.toLocaleDateString("de-DE")}`;

      let activeSession=null; const future=[];
      schedule.forEach(group=>{
        group.times.forEach(time=>{
          if(time.day!==today) return;
          const [sH,sM]=time.start.split(":").map(Number), [eH,eM]=time.end.split(":").map(Number);
          const st=new Date(now), en=new Date(now); st.setHours(sH,sM,0,0); en.setHours(eH,eM,0,0);
          const k=slotKey(time.day,time.start,time.end); const teacher=slotTeacherMap.get(k)||null;
          if(now>=st && now<=en) activeSession={group:group.group,students:group.students,teacher};
          else if(st>now) future.push({group:group.group,students:group.students,teacher,time:st});
        });
      });
      future.sort((a,b)=>a.time-b.time);
      const next=future[0]||null;

      const title=document.getElementById("mainTitle");
      const box=document.getElementById("groupInfoBox");
      const gTitle=document.getElementById("groupTitle");
      const tLine=document.getElementById("teacherLine");
      const gInfo=document.getElementById("groupInfo");
      const count=document.getElementById("countdown");

      if(activeSession){
        document.body.style.background="linear-gradient(180deg,#D32F2F,#B71C1C)";
        title.innerText="Anschlussförderung BO aktiv ❌";
        gTitle.innerText=`Gruppe ${activeSession.group}`;
        tLine.textContent=activeSession.teacher?`Lehrkraft: ${activeSession.teacher}`:"";
        gInfo.innerHTML=`<p class="left-align">${activeSession.students.join("<br>")}</p>`;
        count.classList.add("hidden"); box.classList.remove("hidden");
      } else if(next){
        const diff=next.time-now; const m=Math.floor(diff/60000), s=Math.floor((diff%60000)/1000);

        if(m<=15){
          document.body.style.background="linear-gradient(180deg,#FFD700,#FFA500)";
          title.innerText="Achtung! Gleich Anschlussförderung ⚠️";
          gTitle.innerText=`Gruppe ${next.group}`;
          tLine.textContent=next.teacher?`Lehrkraft: ${next.teacher}`:"";
          gInfo.innerHTML=`<p class="left-align">${next.students.join("<br>")}</p>`;
          count.innerText=m>0?`Startet in ${m} Minute${m===1?"":"n"}`:`Startet in ${s} Sekunde${s===1?"":"n"}`;
          count.classList.remove("hidden"); box.classList.remove("hidden");

          if(m===5){
            const key=next.time.toISOString().slice(0,16);
            if(lastFiveMinuteAlertKey!==key){ lastFiveMinuteAlertKey=key; document.getElementById("alertSound").play().catch(()=>{}); }
          }
        } else {
          document.body.style.background="linear-gradient(180deg,#4CAF50,#388E3C)";
          title.innerText="Anschlussförderung BO ✅";
          box.classList.add("hidden"); count.classList.add("hidden");
        }
      } else {
        document.body.style.background="linear-gradient(180deg,#4CAF50,#388E3C)";
        title.innerText="Anschlussförderung BO ✅";
        box.classList.add("hidden"); count.classList.add("hidden");
      }
    }

    // Übersicht (ohne Lehrkräfte)
    function renderOverview(){
      const c=document.getElementById("overviewContent"); c.innerHTML="";
      schedule.forEach(g=>{
        const box=document.createElement("div"); box.className="box";
        box.innerHTML=`<div class="group-header">Gruppe ${g.group}</div>
          <div class="left-align"><strong>SuS:</strong><br>${g.students.join("<br>")}</div>
          <div class="left-align" style="margin-top:8px"><strong>Termine:</strong><br>${
            g.times.map(t=>`<span class="time-chip">${dayNames[t.day]} ${t.start}–${t.end}</span>`).join(" ")
          }</div>`;
        c.appendChild(box);
      });
    }

    function showOverview(){isOverview=true;document.getElementById("statusView").classList.add("hidden");document.getElementById("overviewView").classList.remove("hidden");renderOverview();}
    function showStatus(){isOverview=false;document.getElementById("overviewView").classList.add("hidden");document.getElementById("statusView").classList.remove("hidden");updateDisplay();}
    document.addEventListener("DOMContentLoaded",()=>{document.getElementById("toggleBtn").addEventListener("click",showOverview);document.getElementById("toggleBtnBack").addEventListener("click",showStatus);});

    function updateClock(){ document.getElementById("clock").innerText=new Date().toLocaleTimeString("de-DE"); }
    updateClock(); updateDisplay();
    setInterval(updateClock,1000);
    setInterval(updateDisplay,1000);
  </script>

  <p id="footer">(Stand: 22.08.2025)</p>
</body>
</html>
